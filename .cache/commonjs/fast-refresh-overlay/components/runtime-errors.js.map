{"version":3,"file":"runtime-errors.js","names":["getCodeFrameInformationFromError","error","forcedLocation","skipSourceMap","moduleId","fileName","functionName","lineNumber","columnNumber","endLineNumber","endColumnNumber","stacktrace","ErrorStackParser","parse","getCodeFrameInformationFromStackTrace","WrappedAccordionItem","open","codeFrameInformation","stack","modulePath","name","filePath","replace","res","useStackFrame","line","sourcePosition","Title","message","openInEditor","decoded","RuntimeErrors","errors","dismiss","deduplicatedErrors","React","useMemo","errorCache","Set","errorList","forEach","cacheKey","secondLine","split","toString","has","push","add","hasMultipleErrors","length","map","index"],"sources":["../../../fast-refresh-overlay/components/runtime-errors.js"],"sourcesContent":["import * as React from \"react\"\nimport ErrorStackParser from \"error-stack-parser\"\nimport { Overlay, Header, HeaderOpenClose, Body } from \"./overlay\"\nimport { useStackFrame } from \"./hooks\"\nimport { CodeFrame } from \"./code-frame\"\nimport { getCodeFrameInformationFromStackTrace, openInEditor } from \"../utils\"\nimport { Accordion, AccordionItem } from \"./accordion\"\n\nfunction getCodeFrameInformationFromError(error) {\n  if (error.forcedLocation) {\n    return {\n      skipSourceMap: true,\n      moduleId: error.forcedLocation.fileName,\n      functionName: error.forcedLocation.functionName,\n      lineNumber: error.forcedLocation.lineNumber,\n      columnNumber: error.forcedLocation.columnNumber,\n      endLineNumber: error.forcedLocation.endLineNumber,\n      endColumnNumber: error.forcedLocation.endColumnNumber,\n    }\n  }\n\n  const stacktrace = ErrorStackParser.parse(error)\n  return getCodeFrameInformationFromStackTrace(stacktrace)\n}\n\nfunction WrappedAccordionItem({ error, open }) {\n  const codeFrameInformation = error.stack\n    ? getCodeFrameInformationFromError(error)\n    : null\n\n  const modulePath = codeFrameInformation?.moduleId\n  const name = codeFrameInformation?.functionName\n  // With the introduction of Metadata management the modulePath can have a resourceQuery that needs to be removed first\n  const filePath = modulePath?.replace(/(\\?|&)export=(default|head)$/, ``)\n\n  const res = useStackFrame(codeFrameInformation)\n  const line = res.sourcePosition?.line\n\n  const Title = () => {\n    if (!name || !error.stack) {\n      return <>Unknown Runtime Error</>\n    }\n\n    return (\n      <>\n        Error in function{` `}\n        <span data-font-weight=\"bold\">{name}</span> in{` `}\n        <span data-font-weight=\"bold\">\n          {filePath}:{line}\n        </span>\n      </>\n    )\n  }\n\n  return (\n    <AccordionItem open={open} title={<Title />}>\n      <p data-gatsby-overlay=\"body__error-message\">{error.message}</p>\n      {error.stack ? (\n        <>\n          <div data-gatsby-overlay=\"codeframe__top\">\n            <div>\n              {filePath}:{line}\n            </div>\n            <button\n              data-gatsby-overlay=\"body__open-in-editor\"\n              onClick={() => openInEditor(filePath, line)}\n            >\n              Open in Editor\n            </button>\n          </div>\n          <CodeFrame decoded={res.decoded} />\n        </>\n      ) : (\n        <p data-font-weight=\"bold\">\n          To identify the exact location of the error, please open the browser's\n          developer tools console.\n        </p>\n      )}\n    </AccordionItem>\n  )\n}\n\nexport function RuntimeErrors({ errors, dismiss }) {\n  const deduplicatedErrors = React.useMemo(() => {\n    const errorCache = new Set()\n    const errorList = []\n    errors.forEach(error => {\n      let cacheKey\n      if (error.stack) {\n        // Second line contains the exact location\n        const secondLine = error.stack?.split(`\\n`)[1]\n        cacheKey = secondLine\n      } else {\n        cacheKey = error.toString()\n      }\n\n      if (!errorCache.has(cacheKey)) {\n        errorList.push(error)\n        errorCache.add(cacheKey)\n      }\n    })\n    return errorList\n  }, [errors])\n  const hasMultipleErrors = deduplicatedErrors.length > 1\n\n  return (\n    <Overlay>\n      <Header data-gatsby-error-type=\"runtime-error\">\n        <div data-gatsby-overlay=\"header__cause-file\">\n          <h1 id=\"gatsby-overlay-labelledby\">\n            {hasMultipleErrors\n              ? `${deduplicatedErrors.length} Unhandled Runtime Errors`\n              : `Unhandled Runtime Error`}\n          </h1>\n        </div>\n        <HeaderOpenClose dismiss={dismiss} />\n      </Header>\n      <Body>\n        <p\n          data-gatsby-overlay=\"body__describedby\"\n          id=\"gatsby-overlay-describedby\"\n        >\n          {hasMultipleErrors ? `Multiple` : `One`} unhandled runtime{` `}\n          {hasMultipleErrors ? `errors` : `error`} found in your files. See the\n          list below to fix {hasMultipleErrors ? `them` : `it`}:\n        </p>\n        <Accordion>\n          {deduplicatedErrors.map((error, index) => (\n            <WrappedAccordionItem\n              open={index === 0}\n              key={`${error.message}-${index}`}\n              error={error}\n            />\n          ))}\n        </Accordion>\n      </Body>\n    </Overlay>\n  )\n}\n"],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAsD;AAAA;AAEtD,SAASA,gCAAgC,CAACC,KAAK,EAAE;EAC/C,IAAIA,KAAK,CAACC,cAAc,EAAE;IACxB,OAAO;MACLC,aAAa,EAAE,IAAI;MACnBC,QAAQ,EAAEH,KAAK,CAACC,cAAc,CAACG,QAAQ;MACvCC,YAAY,EAAEL,KAAK,CAACC,cAAc,CAACI,YAAY;MAC/CC,UAAU,EAAEN,KAAK,CAACC,cAAc,CAACK,UAAU;MAC3CC,YAAY,EAAEP,KAAK,CAACC,cAAc,CAACM,YAAY;MAC/CC,aAAa,EAAER,KAAK,CAACC,cAAc,CAACO,aAAa;MACjDC,eAAe,EAAET,KAAK,CAACC,cAAc,CAACQ;IACxC,CAAC;EACH;EAEA,MAAMC,UAAU,GAAGC,yBAAgB,CAACC,KAAK,CAACZ,KAAK,CAAC;EAChD,OAAO,IAAAa,4CAAqC,EAACH,UAAU,CAAC;AAC1D;AAEA,SAASI,oBAAoB,CAAC;EAAEd,KAAK;EAAEe;AAAK,CAAC,EAAE;EAAA;EAC7C,MAAMC,oBAAoB,GAAGhB,KAAK,CAACiB,KAAK,GACpClB,gCAAgC,CAACC,KAAK,CAAC,GACvC,IAAI;EAER,MAAMkB,UAAU,GAAGF,oBAAoB,aAApBA,oBAAoB,uBAApBA,oBAAoB,CAAEb,QAAQ;EACjD,MAAMgB,IAAI,GAAGH,oBAAoB,aAApBA,oBAAoB,uBAApBA,oBAAoB,CAAEX,YAAY;EAC/C;EACA,MAAMe,QAAQ,GAAGF,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEG,OAAO,CAAC,8BAA8B,EAAG,EAAC,CAAC;EAExE,MAAMC,GAAG,GAAG,IAAAC,oBAAa,EAACP,oBAAoB,CAAC;EAC/C,MAAMQ,IAAI,0BAAGF,GAAG,CAACG,cAAc,wDAAlB,oBAAoBD,IAAI;EAErC,MAAME,KAAK,GAAG,MAAM;IAClB,IAAI,CAACP,IAAI,IAAI,CAACnB,KAAK,CAACiB,KAAK,EAAE;MACzB,oBAAO,0CAAE,uBAAqB,CAAG;IACnC;IAEA,oBACE,0CAAE,mBACiB,EAAE,GAAE,eACrB;MAAM,oBAAiB;IAAM,GAAEE,IAAI,CAAQ,OAAG,EAAE,GAAE,eAClD;MAAM,oBAAiB;IAAM,GAC1BC,QAAQ,EAAC,GAAC,EAACI,IAAI,CACX,CACN;EAEP,CAAC;EAED,oBACE,oBAAC,wBAAa;IAAC,IAAI,EAAET,IAAK;IAAC,KAAK,eAAE,oBAAC,KAAK;EAAI,gBAC1C;IAAG,uBAAoB;EAAqB,GAAEf,KAAK,CAAC2B,OAAO,CAAK,EAC/D3B,KAAK,CAACiB,KAAK,gBACV,uDACE;IAAK,uBAAoB;EAAgB,gBACvC,iCACGG,QAAQ,EAAC,GAAC,EAACI,IAAI,CACZ,eACN;IACE,uBAAoB,sBAAsB;IAC1C,OAAO,EAAE,MAAM,IAAAI,mBAAY,EAACR,QAAQ,EAAEI,IAAI;EAAE,GAC7C,gBAED,CAAS,CACL,eACN,oBAAC,oBAAS;IAAC,OAAO,EAAEF,GAAG,CAACO;EAAQ,EAAG,CAClC,gBAEH;IAAG,oBAAiB;EAAM,GAAC,iGAG3B,CACD,CACa;AAEpB;AAEO,SAASC,aAAa,CAAC;EAAEC,MAAM;EAAEC;AAAQ,CAAC,EAAE;EACjD,MAAMC,kBAAkB,GAAGC,KAAK,CAACC,OAAO,CAAC,MAAM;IAC7C,MAAMC,UAAU,GAAG,IAAIC,GAAG,EAAE;IAC5B,MAAMC,SAAS,GAAG,EAAE;IACpBP,MAAM,CAACQ,OAAO,CAACvC,KAAK,IAAI;MACtB,IAAIwC,QAAQ;MACZ,IAAIxC,KAAK,CAACiB,KAAK,EAAE;QAAA;QACf;QACA,MAAMwB,UAAU,mBAAGzC,KAAK,CAACiB,KAAK,iDAAX,aAAayB,KAAK,CAAE,IAAG,CAAC,CAAC,CAAC,CAAC;QAC9CF,QAAQ,GAAGC,UAAU;MACvB,CAAC,MAAM;QACLD,QAAQ,GAAGxC,KAAK,CAAC2C,QAAQ,EAAE;MAC7B;MAEA,IAAI,CAACP,UAAU,CAACQ,GAAG,CAACJ,QAAQ,CAAC,EAAE;QAC7BF,SAAS,CAACO,IAAI,CAAC7C,KAAK,CAAC;QACrBoC,UAAU,CAACU,GAAG,CAACN,QAAQ,CAAC;MAC1B;IACF,CAAC,CAAC;IACF,OAAOF,SAAS;EAClB,CAAC,EAAE,CAACP,MAAM,CAAC,CAAC;EACZ,MAAMgB,iBAAiB,GAAGd,kBAAkB,CAACe,MAAM,GAAG,CAAC;EAEvD,oBACE,oBAAC,gBAAO,qBACN,oBAAC,eAAM;IAAC,0BAAuB;EAAe,gBAC5C;IAAK,uBAAoB;EAAoB,gBAC3C;IAAI,EAAE,EAAC;EAA2B,GAC/BD,iBAAiB,GACb,GAAEd,kBAAkB,CAACe,MAAO,2BAA0B,GACtD,yBAAwB,CAC1B,CACD,eACN,oBAAC,wBAAe;IAAC,OAAO,EAAEhB;EAAQ,EAAG,CAC9B,eACT,oBAAC,aAAI,qBACH;IACE,uBAAoB,mBAAmB;IACvC,EAAE,EAAC;EAA4B,GAE9Be,iBAAiB,GAAI,UAAS,GAAI,KAAI,EAAC,oBAAkB,EAAE,GAAE,EAC7DA,iBAAiB,GAAI,QAAO,GAAI,OAAM,EAAC,kDACtB,EAACA,iBAAiB,GAAI,MAAK,GAAI,IAAG,EAAC,GACvD,CAAI,eACJ,oBAAC,oBAAS,QACPd,kBAAkB,CAACgB,GAAG,CAAC,CAACjD,KAAK,EAAEkD,KAAK,kBACnC,oBAAC,oBAAoB;IACnB,IAAI,EAAEA,KAAK,KAAK,CAAE;IAClB,GAAG,EAAG,GAAElD,KAAK,CAAC2B,OAAQ,IAAGuB,KAAM,EAAE;IACjC,KAAK,EAAElD;EAAM,EAEhB,CAAC,CACQ,CACP,CACC;AAEd"}